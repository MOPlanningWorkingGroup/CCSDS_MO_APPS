<?xml version="1.0" encoding="UTF-8"?> 
<definitions id="Definition"
             targetNamespace="http://www.jboss.org/drools"
             typeLanguage="http://www.java.com/javaTypes"
             expressionLanguage="http://www.mvel.org/2.0"
             xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xsi:schemaLocation="http://www.omg.org/spec/BPMN/20100524/MODEL BPMN20.xsd"
             xmlns:g="http://www.jboss.org/drools/flow/gpd"
             xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI"
             xmlns:dc="http://www.omg.org/spec/DD/20100524/DC"
             xmlns:di="http://www.omg.org/spec/DD/20100524/DI"
             xmlns:tns="http://www.jboss.org/drools">

  <itemDefinition id="_taskServiceConsumer" structureRef="org.ccsds.moims.mo.mal.planning.consumer.TaskServiceConsumer" />
  <itemDefinition id="_planningRequestConsumer" structureRef="org.ccsds.moims.mo.mal.planning.consumer.PlanningRequestServiceConsumer" />
  <itemDefinition id="_taskDefList" structureRef="org.ccsds.moims.mo.planning.task.structures.TaskDefinitionList" />
  <itemDefinition id="_taskDefLongList" structureRef="org.ccsds.moims.mo.mal.structures.LongList" />
  <itemDefinition id="_prDef1" structureRef="org.ccsds.moims.mo.planning.planningrequest.structures.PlanningRequestDefinition" />
  <itemDefinition id="_prDef2" structureRef="org.ccsds.moims.mo.planning.planningrequest.structures.PlanningRequestDefinition" />
  <itemDefinition id="_prDefId1" structureRef="Long" />
  <itemDefinition id="_prDefId2" structureRef="Long" />

  <process processType="Private" isExecutable="true" id="org.ccsds.moims.mo.mal.scenarios.goce" name="init_mps" >

    <!-- process variables -->
    <property id="taskServiceConsumer" itemSubjectRef="_taskServiceConsumer"/>
    <property id="planningRequestConsumer" itemSubjectRef="_planningRequestConsumer"/>
    <property id="taskDefList" itemSubjectRef="_taskDefList"/>
    <property id="taskDefLongList" itemSubjectRef="_taskDefLongList"/>
    <property id="prDef1" itemSubjectRef="_prDef1"/>
    <property id="prDef2" itemSubjectRef="_prDef2"/>
    <property id="prDefId1" itemSubjectRef="_prDefId1"/>
    <property id="prDefId2" itemSubjectRef="_prDefId2"/>

    <!-- nodes -->
    <startEvent id="_jbpm-unique-15" name="Start"  isInterrupting="false"/>
    <parallelGateway id="_jbpm-unique-16" name="Gateway" gatewayDirection="Diverging" />
    <scriptTask id="_jbpm-unique-17" name="Define new Task" scriptFormat="http://www.java.com/java" >
      <script>
		org.ccsds.moims.mo.planning.task.structures.TaskDefinition def = new org.ccsds.moims.mo.planning.task.structures.TaskDefinition();
		def.setName("test1");
		def.setDescription("description1");
		org.ccsds.moims.mo.planning.task.structures.TaskArgumentDefinitionList arguments = new org.ccsds.moims.mo.planning.task.structures.TaskArgumentDefinitionList();
		def.setArguments(arguments);
		taskDefList.add(def);
    	</script>
    </scriptTask>
    <scriptTask id="_jbpm-unique-19" name="Define new Task" scriptFormat="http://www.java.com/java" >
      <script>
		org.ccsds.moims.mo.planning.task.structures.TaskDefinition def = new org.ccsds.moims.mo.planning.task.structures.TaskDefinition();
		def.setName("test2");
		def.setDescription("description1");
		org.ccsds.moims.mo.planning.task.structures.TaskArgumentDefinitionList arguments = new org.ccsds.moims.mo.planning.task.structures.TaskArgumentDefinitionList();
		def.setArguments(arguments);
		taskDefList.add(def);
    	</script>
    </scriptTask>
    <scriptTask id="_jbpm-unique-20" name="Define new Task" scriptFormat="http://www.java.com/java" >
      <script>
		org.ccsds.moims.mo.planning.task.structures.TaskDefinition def = new org.ccsds.moims.mo.planning.task.structures.TaskDefinition();
		def.setName("test3");
		def.setDescription("description1");
		org.ccsds.moims.mo.planning.task.structures.TaskArgumentDefinitionList arguments = new org.ccsds.moims.mo.planning.task.structures.TaskArgumentDefinitionList();
		def.setArguments(arguments);
		taskDefList.add(def);
    	</script>
    </scriptTask>
    <endEvent id="_jbpm-unique-26" name="End" >
        <terminateEventDefinition />
    </endEvent>
    <scriptTask id="_jbpm-unique-27" name="Define new Planning Request" scriptFormat="http://www.java.com/java" >
      <script>
        prDef1 = new org.ccsds.moims.mo.planning.planningrequest.structures.PlanningRequestDefinition();
		prDef1.setName("test1");
		prDef1.setDescription("description");
		prDef1.setAllowedTaskTypes(taskDefList);
		kcontext.setVariable("prDef1", prDef1);
      </script>
    </scriptTask>
    <scriptTask id="_jbpm-unique-28" name="Define new Planning Request" scriptFormat="http://www.java.com/java" >
      <script>
        prDef2 = new org.ccsds.moims.mo.planning.planningrequest.structures.PlanningRequestDefinition();
		prDef2.setName("test1");
		prDef2.setDescription("description");
		prDef2.setAllowedTaskTypes(taskDefList);
		kcontext.setVariable("prDef2", prDef2);
      </script>
    </scriptTask>
    <scriptTask id="_jbpm-unique-29" name="Add new PR definition" scriptFormat="http://www.java.com/java" >
      <script>
        kcontext.setVariable("prDefId1", planningRequestConsumer.getPlanningRequestService().addDefinition(prDef1));
      </script>
    </scriptTask>
    <scriptTask id="_jbpm-unique-30" name="Add new PR definition" scriptFormat="http://www.java.com/java" >
      <script>
        kcontext.setVariable("prDefId2", planningRequestConsumer.getPlanningRequestService().addDefinition(prDef2));
      </script>
    </scriptTask>
    <parallelGateway id="_jbpm-unique-31" name="Gateway" gatewayDirection="Diverging" />
    <parallelGateway id="_jbpm-unique-32" name="Gateway" gatewayDirection="Converging" />
    <parallelGateway id="_jbpm-unique-33" name="Gateway" gatewayDirection="Converging" />
    <scriptTask id="_jbpm-unique-23" name="Add Task definition list" scriptFormat="http://www.java.com/java" >
      <script>
        kcontext.setVariable("taskDefLongList", taskServiceConsumer.getTaskService().addDefinition(taskDefList));
      </script>
    </scriptTask>
    <scriptTask id="_jbpm-unique-34" name="Log PR Def ID" >
      <script>System.out.println("PR Definition1 id is " + prDefId1);</script>
    </scriptTask>
    <scriptTask id="_jbpm-unique-35" name="Log PR Def ID" >
      <script>System.out.println("PR Definition2 id is " + prDefId2);</script>
    </scriptTask>

    <!-- connections -->
    <sequenceFlow id="_jbpm-unique-15-_jbpm-unique-16" sourceRef="_jbpm-unique-15" targetRef="_jbpm-unique-16" />
    <sequenceFlow id="_jbpm-unique-16-_jbpm-unique-17" sourceRef="_jbpm-unique-16" targetRef="_jbpm-unique-17" />
    <sequenceFlow id="_jbpm-unique-16-_jbpm-unique-19" sourceRef="_jbpm-unique-16" targetRef="_jbpm-unique-19" />
    <sequenceFlow id="_jbpm-unique-16-_jbpm-unique-20" sourceRef="_jbpm-unique-16" targetRef="_jbpm-unique-20" />
    <sequenceFlow id="_jbpm-unique-32-_jbpm-unique-26" sourceRef="_jbpm-unique-32" targetRef="_jbpm-unique-26" />
    <sequenceFlow id="_jbpm-unique-31-_jbpm-unique-27" sourceRef="_jbpm-unique-31" targetRef="_jbpm-unique-27" />
    <sequenceFlow id="_jbpm-unique-31-_jbpm-unique-28" sourceRef="_jbpm-unique-31" targetRef="_jbpm-unique-28" />
    <sequenceFlow id="_jbpm-unique-27-_jbpm-unique-29" sourceRef="_jbpm-unique-27" targetRef="_jbpm-unique-29" />
    <sequenceFlow id="_jbpm-unique-28-_jbpm-unique-30" sourceRef="_jbpm-unique-28" targetRef="_jbpm-unique-30" />
    <sequenceFlow id="_jbpm-unique-23-_jbpm-unique-31" sourceRef="_jbpm-unique-23" targetRef="_jbpm-unique-31" />
    <sequenceFlow id="_jbpm-unique-34-_jbpm-unique-32" sourceRef="_jbpm-unique-34" targetRef="_jbpm-unique-32" />
    <sequenceFlow id="_jbpm-unique-35-_jbpm-unique-32" sourceRef="_jbpm-unique-35" targetRef="_jbpm-unique-32" />
    <sequenceFlow id="_jbpm-unique-17-_jbpm-unique-33" sourceRef="_jbpm-unique-17" targetRef="_jbpm-unique-33" />
    <sequenceFlow id="_jbpm-unique-19-_jbpm-unique-33" sourceRef="_jbpm-unique-19" targetRef="_jbpm-unique-33" />
    <sequenceFlow id="_jbpm-unique-20-_jbpm-unique-33" sourceRef="_jbpm-unique-20" targetRef="_jbpm-unique-33" />
    <sequenceFlow id="_jbpm-unique-33-_jbpm-unique-23" sourceRef="_jbpm-unique-33" targetRef="_jbpm-unique-23" />
    <sequenceFlow id="_jbpm-unique-29-_jbpm-unique-34" sourceRef="_jbpm-unique-29" targetRef="_jbpm-unique-34" />
    <sequenceFlow id="_jbpm-unique-30-_jbpm-unique-35" sourceRef="_jbpm-unique-30" targetRef="_jbpm-unique-35" />

  </process>

  <bpmndi:BPMNDiagram>
    <bpmndi:BPMNPlane bpmnElement="org.ccsds.moims.mo.mal.scenarios.goce" >
      <bpmndi:BPMNShape bpmnElement="_jbpm-unique-15" >
        <dc:Bounds x="283" y="13" width="48" height="48" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="_jbpm-unique-16" >
        <dc:Bounds x="286" y="71" width="48" height="48" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="_jbpm-unique-17" >
        <dc:Bounds x="81" y="141" width="140" height="48" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="_jbpm-unique-19" >
        <dc:Bounds x="243" y="143" width="117" height="48" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="_jbpm-unique-20" >
        <dc:Bounds x="385" y="142" width="146" height="48" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="_jbpm-unique-26" >
        <dc:Bounds x="325" y="569" width="48" height="48" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="_jbpm-unique-27" >
        <dc:Bounds x="30" y="357" width="199" height="48" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="_jbpm-unique-28" >
        <dc:Bounds x="469" y="345" width="232" height="48" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="_jbpm-unique-29" >
        <dc:Bounds x="43" y="436" width="164" height="48" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="_jbpm-unique-30" >
        <dc:Bounds x="510" y="420" width="158" height="48" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="_jbpm-unique-31" >
        <dc:Bounds x="309" y="371" width="48" height="48" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="_jbpm-unique-32" >
        <dc:Bounds x="333" y="485" width="48" height="48" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="_jbpm-unique-33" >
        <dc:Bounds x="298" y="227" width="48" height="48" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="_jbpm-unique-23" >
        <dc:Bounds x="267" y="304" width="155" height="48" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="_jbpm-unique-34" >
        <dc:Bounds x="49" y="503" width="148" height="48" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape bpmnElement="_jbpm-unique-35" >
        <dc:Bounds x="511" y="497" width="149" height="48" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge bpmnElement="_jbpm-unique-15-_jbpm-unique-16" >
        <di:waypoint x="307" y="37" />
        <di:waypoint x="310" y="95" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="_jbpm-unique-16-_jbpm-unique-17" >
        <di:waypoint x="310" y="95" />
        <di:waypoint x="151" y="165" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="_jbpm-unique-16-_jbpm-unique-19" >
        <di:waypoint x="310" y="95" />
        <di:waypoint x="301" y="167" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="_jbpm-unique-16-_jbpm-unique-20" >
        <di:waypoint x="310" y="95" />
        <di:waypoint x="458" y="166" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="_jbpm-unique-32-_jbpm-unique-26" >
        <di:waypoint x="357" y="509" />
        <di:waypoint x="349" y="593" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="_jbpm-unique-31-_jbpm-unique-27" >
        <di:waypoint x="333" y="395" />
        <di:waypoint x="129" y="381" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="_jbpm-unique-31-_jbpm-unique-28" >
        <di:waypoint x="333" y="395" />
        <di:waypoint x="585" y="369" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="_jbpm-unique-27-_jbpm-unique-29" >
        <di:waypoint x="129" y="381" />
        <di:waypoint x="125" y="460" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="_jbpm-unique-28-_jbpm-unique-30" >
        <di:waypoint x="585" y="369" />
        <di:waypoint x="589" y="444" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="_jbpm-unique-23-_jbpm-unique-31" >
        <di:waypoint x="344" y="328" />
        <di:waypoint x="333" y="395" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="_jbpm-unique-34-_jbpm-unique-32" >
        <di:waypoint x="123" y="527" />
        <di:waypoint x="357" y="509" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="_jbpm-unique-35-_jbpm-unique-32" >
        <di:waypoint x="585" y="521" />
        <di:waypoint x="357" y="509" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="_jbpm-unique-17-_jbpm-unique-33" >
        <di:waypoint x="151" y="165" />
        <di:waypoint x="322" y="251" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="_jbpm-unique-19-_jbpm-unique-33" >
        <di:waypoint x="301" y="167" />
        <di:waypoint x="322" y="251" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="_jbpm-unique-20-_jbpm-unique-33" >
        <di:waypoint x="458" y="166" />
        <di:waypoint x="322" y="251" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="_jbpm-unique-33-_jbpm-unique-23" >
        <di:waypoint x="322" y="251" />
        <di:waypoint x="344" y="328" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="_jbpm-unique-29-_jbpm-unique-34" >
        <di:waypoint x="125" y="460" />
        <di:waypoint x="123" y="527" />
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge bpmnElement="_jbpm-unique-30-_jbpm-unique-35" >
        <di:waypoint x="589" y="444" />
        <di:waypoint x="585" y="521" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>

</definitions>